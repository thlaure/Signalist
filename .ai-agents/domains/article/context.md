# Article Domain Context

## Overview
The Article domain handles content extracted from RSS feeds: storage, full-text extraction, summarization, and tagging.

---

## Business Rules

1. **Articles are unique per feed** - Use `feedId + externalId` composite
2. **Full content extraction is async** - Use Readability library
3. **Summaries are AI-generated** - Async via LLM
4. **Tags can be manual or auto-generated** - Track source
5. **Reading state is per-user** (future: multi-tenant)

---

## Entities

### Article
```
- id: UUID
- feedId: UUID (required)
- externalId: string (RSS guid/link)
- title: string
- content: text (nullable, full extracted content)
- summary: text (nullable, AI-generated)
- sourceUrl: string (original article URL)
- author: string (nullable)
- publishedAt: DateTime
- isRead: bool (default: false)
- createdAt: DateTime
- updatedAt: DateTime
```

### Tag
```
- id: UUID
- name: string (unique, lowercase)
- createdAt: DateTime
```

### ArticleTag (Join Entity)
```
- id: UUID
- articleId: UUID
- tagId: UUID
- isAutoGenerated: bool
- createdAt: DateTime
```

---

## Commands

| Command | Purpose | Handler |
|---------|---------|---------|
| `CreateArticleCommand` | Create from RSS item | Internal, from crawler |
| `MarkArticleReadCommand` | Mark as read | Updates `isRead` |
| `MarkArticleUnreadCommand` | Mark as unread | Updates `isRead` |
| `AddTagToArticleCommand` | Manual tagging | Creates ArticleTag |
| `RemoveTagFromArticleCommand` | Remove tag | Deletes ArticleTag |

---

## Queries

| Query | Purpose |
|-------|---------|
| `ArticleListQuery` | Paginated list with filters |
| `ArticleDetailQuery` | Single article with tags |
| `UnreadArticlesQuery` | Unread articles for newsletter |

---

## Async Messages

| Message | Handler | Trigger |
|---------|---------|---------|
| `ExtractArticleContentMessage` | Fetches full HTML, extracts with Readability | After article created |
| `GenerateArticleSummaryMessage` | LLM summarization | After content extracted |
| `GenerateArticleTagsMessage` | LLM auto-tagging | After content extracted |
| `GenerateArticleEmbeddingsMessage` | Create vector embeddings | After content extracted |

---

## Content Extraction Pipeline

```
ExtractArticleContentMessage
    ↓
Fetch article URL
    ↓
Parse HTML with Readability
    ↓
Extract: title, content, author, publishedAt
    ↓
Update Article.content
    ↓
Dispatch:
    - GenerateArticleSummaryMessage
    - GenerateArticleTagsMessage
    - GenerateArticleEmbeddingsMessage
```

---

## Error Handling (RFC 7807)

| Error | Exception | Problem Type | Status |
|-------|-----------|--------------|--------|
| Article not found | `ArticleNotFoundException` | `/problems/not-found` | 404 |
| Content extraction failed | `ContentExtractionException` | - (logged, async) | - |
| Tag not found | `TagNotFoundException` | `/problems/not-found` | 404 |

---

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | `/api/v1/articles` | List articles (filterable) |
| GET | `/api/v1/articles/{id}` | Get article detail |
| POST | `/api/v1/articles/{id}/read` | Mark as read |
| DELETE | `/api/v1/articles/{id}/read` | Mark as unread |
| POST | `/api/v1/articles/{id}/tags` | Add tag |
| DELETE | `/api/v1/articles/{id}/tags/{tagId}` | Remove tag |
| GET | `/api/v1/tags` | List all tags |

---

## Related Domains

- **Feed**: Articles belong to feeds
- **Search**: Articles have embeddings for semantic search
- **Bookmark**: Articles can be bookmarked
- **Newsletter**: Articles included in newsletters
